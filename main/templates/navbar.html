<nav class="fixed top-0 left-0 w-full z-50">
  <!-- backdrop + blur for nicer look -->
  <div class="backdrop-blur-sm bg-white/70 dark:bg-gray-900/60 border-b border-gray-200 dark:border-gray-800 shadow-sm">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo -->
        <div class="flex items-center gap-4">
          <a href="/" class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-md flex items-center justify-center bg-green-600 text-white font-bold text-lg shadow">
              HoC
            </div>
            <div class="leading-tight">
              <div class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                <span class="text-green-600">House of</span> Champions
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Premium products & community</div>
            </div>
          </a>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-8">
          <a href="/" class="text-gray-600 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white font-medium transition-colors">Home</a>            
          <button id="create-product-btn" class="text-gray-600 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white font-medium transition-colors">Create Product</button>
        </div>

        <!-- Right: user + theme -->
        <div class="flex items-center gap-4">
          <!-- Theme toggle (sun / moon icon) -->
          <button id="nav-theme-toggle" aria-label="Toggle theme" class="flex items-center p-2 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm hover:shadow transition">
            <svg id="nav-icon-sun" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-9H21M3 12h1m15.36 6.36l-.7-.7M6.34 6.34l-.7-.7m12.02 12.02l-.7-.7M6.34 17.66l-.7-.7M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
            <svg id="nav-icon-moon" class="h-5 w-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 116.707 2.707 7 7 0 0017.293 13.293z"/></svg>
          </button>

          <!-- Desktop user area -->
          <div class="hidden md:flex items-center space-x-4">
            {% if user.is_authenticated %}
              <div class="text-right">
                <div class="text-sm font-medium text-gray-900 dark:text-gray-100">{{ user.username }}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">{{ user.email|default:"Member" }}</div>
              </div>
              <button id="logout-btn" class="text-red-600 hover:text-red-700 font-medium transition-colors">Logout</button>
            {% else %}
              <button id="login-btn" class="text-gray-600 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white font-medium transition-colors">Login</button>
              <button id="register-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-medium transition-colors">Register</button>
            {% endif %}
          </div>

          <!-- Mobile menu button -->
          <div class="md:hidden flex items-center">
            <button id="mobile-menu-button" class="p-2 text-gray-600 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white transition-colors" aria-expanded="false" aria-controls="mobile-menu">
              <span class="sr-only">Open menu</span>
              <!-- hamburger -->
              <div class="w-6 h-6 flex flex-col justify-center items-center">
                <span class="bg-current block h-0.5 w-6 rounded-sm"></span>
                <span class="bg-current block h-0.5 w-6 rounded-sm my-1"></span>
                <span class="bg-current block h-0.5 w-6 rounded-sm"></span>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800">
      <div class="px-6 py-4 space-y-4">
        <a href="/" class="block text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white font-medium py-2">Home</a>
        <button id="mobile-create-product-btn" class="block w-full text-left text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white font-medium py-2">Create Product</button>

        <div class="border-t border-gray-100 dark:border-gray-800 pt-4">
          {% if user.is_authenticated %}
            <div class="mb-3">
              <div class="font-medium text-gray-900 dark:text-gray-100">{{ user.username }}</div>
              <div class="text-sm text-gray-500 dark:text-gray-400">{{ user.email|default:"Member" }}</div>
            </div>
            <button id="mobile-logout-btn" class="block w-full text-left text-red-600 hover:text-red-700 font-medium py-2">Logout</button>
          {% else %}
            <button id="mobile-login-btn" class="block w-full text-left text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white font-medium py-2">Login</button>
            <button id="mobile-register-btn" class="block w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded text-center mt-2">Register</button>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
  (function () {
    // Mobile menu toggle
    const mobileBtn = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileBtn?.addEventListener('click', () => {
      const opened = mobileMenu.classList.toggle('hidden');
      mobileBtn.setAttribute('aria-expanded', (!opened).toString());
    });

    // Theme toggle functionality
    const html = document.documentElement;
    const navToggle = document.getElementById('nav-theme-toggle');
    const iconSun = document.getElementById('nav-icon-sun');
    const iconMoon = document.getElementById('nav-icon-moon');

    function storedTheme() { return localStorage.getItem('theme'); }
    function systemPrefersDark() { return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; }
    function isDark() {
      const s = storedTheme();
      if (s) return s === 'dark';
      return systemPrefersDark();
    }

    function setIcons(dark) {
      if (dark) {
        iconSun.classList.remove('hidden');
        iconMoon.classList.add('hidden');
      } else {
        iconSun.classList.add('hidden');
        iconMoon.classList.remove('hidden');
      }
    }

    function applyTheme(dark) {
      if (dark) {
        html.classList.add('dark');
        html.classList.remove('light');
      } else {
        html.classList.remove('dark');
        html.classList.add('light');
      }
      setIcons(dark);
    }

    // Initialize theme
    applyTheme(isDark());

    navToggle?.addEventListener('click', () => {
      const next = !html.classList.contains('dark');
      applyTheme(next);
      localStorage.setItem('theme', next ? 'dark' : 'light');
    });

    // Respond to system theme changes
    try {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!storedTheme()) applyTheme(e.matches);
      });
    } catch (e) { /* older browsers */ }

    // Event handlers for AJAX actions
    function setupEventHandlers() {
      // Create product buttons
      document.getElementById('create-product-btn')?.addEventListener('click', () => {
        if (window.productApp) window.productApp.openCreateModal();
      });
      
      document.getElementById('mobile-create-product-btn')?.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        if (window.productApp) window.productApp.openCreateModal();
      });

      // Authentication buttons
      document.getElementById('login-btn')?.addEventListener('click', () => {
        if (window.productApp) window.productApp.openLoginModal();
      });
      
      document.getElementById('register-btn')?.addEventListener('click', () => {
        if (window.productApp) window.productApp.openRegisterModal();
      });
      
      document.getElementById('logout-btn')?.addEventListener('click', () => {
        if (window.productApp) window.productApp.handleLogout();
      });

      // Mobile authentication buttons
      document.getElementById('mobile-login-btn')?.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        if (window.productApp) window.productApp.openLoginModal();
      });
      
      document.getElementById('mobile-register-btn')?.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        if (window.productApp) window.productApp.openRegisterModal();
      });
      
      document.getElementById('mobile-logout-btn')?.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        if (window.productApp) window.productApp.handleLogout();
      });
    }

    // Initialize event handlers when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupEventHandlers);
    } else {
      setupEventHandlers();
    }
  })();
</script>