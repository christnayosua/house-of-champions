{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>House Of Champions</title>
{% endblock meta %}

{% block extra_head %}
<!-- Mendapatkan google font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

<style>
  /* Melakukan dekorasi untuk class selector */
  .decor-bg-home {
    position: fixed; inset: 0 0 auto 0; height: 36vh; z-index: -1;
    background-image: url('https://i.pinimg.com/1200x/44/24/62/44246235fc68567de2d96e63b642d6c6.jpg');
    background-size: cover; background-position: right top; opacity: .40;
    filter: saturate(.95) brightness(.95);
    transition: opacity .2s ease, transform .2s ease;
    transform: translateY(-6%);
  }
  @media (max-width: 768px) { .decor-bg-home { background-position: center top; height: 24vh; } }

  /* Toggle button micro-animation */
  .theme-toggle { transition: transform .14s ease; }
  .theme-toggle:active { transform: scale(.97); }
</style>
{% endblock extra_head %}

{% block content %}
<!-- decoration -->
<div class="decor-bg-home" aria-hidden="true"></div>

<!-- Site wrapper -->
<div id="site-root" class="min-h-screen font-inter antialiased bg-gray-50 dark:bg-slate-900 transition-colors duration-200">

  {% include 'navbar.html' %}

  <!-- Theme control (persisted by JS) -->
  <div class="fixed right-4 bottom-6 z-50">
    <button id="btn-theme" class="theme-toggle inline-flex items-center gap-2 px-3 py-2 rounded-full shadow-lg bg-white/90 dark:bg-slate-800/90 border border-gray-200 dark:border-slate-700"
            aria-label="Toggle theme" title="Toggle theme">
      <svg id="icon-sun" class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
        <path d="M12 3v2M12 19v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M3 12h2M19 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" />
      </svg>
      <svg id="icon-moon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span id="theme-label" class="text-sm font-medium text-slate-700 dark:text-slate-200">Theme</span>
    </button>
  </div>

  <main class="pt-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <!-- Hero -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 items-center mb-10">
      <div>
        <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight text-slate-900 dark:text-white">
          Discover the Latest<br>
          <span class="text-emerald-500">House of Champions</span>
        </h1>
        <p class="mt-4 text-lg text-slate-600 dark:text-slate-300 max-w-xl">Curated football products, stories and community picks. Add your own and be featured.</p>

        <div class="mt-6 flex flex-wrap gap-3">
          <a href="{% url 'main:create_products' %}" class="inline-flex items-center px-5 py-3 rounded-md bg-emerald-500 text-white font-medium shadow hover:brightness-105">Create Product</a>
          <a href="#" class="inline-flex items-center px-5 py-3 rounded-md bg-white/90 border text-slate-800 hover:shadow">Explore</a>
        </div>
      </div>

      <div class="hidden lg:flex justify-end">
        <div class="w-80 h-48 rounded-2xl overflow-hidden shadow-2xl ring-1 ring-black/5 dark:ring-white/5 transform hover:scale-[1.02] transition-all">
          <img src="https://i.pinimg.com/736x/9e/e4/18/9ee4180999c90b7075a315fbf9d37e81.jpg" alt="preview" class="w-full h-full object-cover">
        </div>
      </div>
    </section>

    <!-- Filters -->
    <section class="mb-8">
      <div class="inline-flex gap-3 bg-white/80 dark:bg-slate-800/60 p-3 rounded-lg shadow-sm">
        <a href="?filter=all" class="px-4 py-2 rounded-md font-medium {% if not request.GET.filter or request.GET.filter == 'all' %}bg-emerald-500 text-white{% else %}bg-transparent text-slate-700 dark:text-slate-200 ring-1 ring-black/5 dark:ring-white/5{% endif %}">All</a>
        <a href="?filter=my" class="px-4 py-2 rounded-md font-medium {% if request.GET.filter == 'my' %}bg-emerald-500 text-white{% else %}bg-transparent text-slate-700 dark:text-slate-200 ring-1 ring-black/5 dark:ring-white/5{% endif %}">My</a>
        <a href="?filter=hot" class="px-4 py-2 rounded-md font-medium {% if request.GET.filter == 'hot' %}bg-emerald-500 text-white{% else %}bg-transparent text-slate-700 dark:text-slate-200 ring-1 ring-black/5 dark:ring-white/5{% endif %}">Hot ðŸ”¥</a>
      </div>

      {% if user.is_authenticated %}
        <div class="mt-3 text-sm text-slate-500 dark:text-slate-300">Last login: {{ last_login }}</div>
      {% endif %}
    </section>

    <!-- Products grid -->
    {% if not products_list %}
      <div class="bg-white dark:bg-slate-800 p-12 rounded-2xl shadow border border-black/5 dark:border-white/5 text-center">
        <div class="w-28 h-28 mx-auto mb-4">
          <video autoplay muted loop class="w-full h-full object-contain">
            <source src="{% static 'video/no-products.mp4' %}" type="video/mp4">
          </video>
        </div>
        <img src="https://i.pinimg.com/originals/ab/c9/6f/abc96f284c5fd1a927380fe94b07a816.gif" alt="no Products" class="mx-auto rounded-xl mb-6 mt-2">
        <h3 class="text-xl font-semibold text-slate-900 dark:text-white mb-2">No products found</h3>
        <p class="text-slate-600 dark:text-slate-300 mb-4">Be the first to add a product.</p>
        <a href="{% url 'main:create_products' %}" class="inline-block px-4 py-2 bg-emerald-500 text-white rounded-md">Create Product</a>
      </div>
    {% else %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for products in products_list %}
          {% include 'card_products.html' with products=products %}
        {% endfor %}
      </div>
    {% endif %}
  </main>
</div>

<!-- Theme script: toggles 'dark' class on <html> and persists choice to localStorage -->
<script>
(function () {
  const root = document.documentElement;
  const btn = document.getElementById('btn-theme');
  const iconSun = document.getElementById('icon-sun');
  const iconMoon = document.getElementById('icon-moon');
  const label = document.getElementById('theme-label');

  // get initial preference: from localStorage -> else prefers-color-scheme -> else light
  function getStoredTheme() {
    try { return localStorage.getItem('site-theme'); } catch (e) { return null; }
  }
  function storeTheme(t) {
    try { localStorage.setItem('site-theme', t); } catch (e) {}
  }

  function prefersDark() {
    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  }

  function applyTheme(theme) {
    if (theme === 'dark') {
      root.classList.add('dark');
      iconSun.classList.add('hidden');
      iconMoon.classList.remove('hidden');
      label.textContent = 'Dark';
    } else {
      root.classList.remove('dark');
      iconMoon.classList.add('hidden');
      iconSun.classList.remove('hidden');
      label.textContent = 'Light';
    }
  }

  // initialize
  let theme = getStoredTheme();
  if (!theme) theme = prefersDark() ? 'dark' : 'light';
  applyTheme(theme);

  // toggle handler
  btn.addEventListener('click', function () {
    const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
    applyTheme(newTheme);
    storeTheme(newTheme);
  });
})();
</script>
{% endblock content %}
